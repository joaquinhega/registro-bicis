import{ag as K,_ as a,N as M,ah as ve,af as u,a6 as k,ai as L,aj as ae,ak as Ee,J as Se,al as ye,am as V,an as B,ao as U,ap as S,S as I,aq as H,ar as T,as as G,at as Ie}from"./index-WQCy-1cm.js";function R(){}const Z="SYN",j="ACK",X="BRK";class ee extends K.Duplex{constructor({name:e,target:t,targetWindow:n=window,targetOrigin:r="*"}){if(super({objectMode:!0}),a(this,"_init",void 0),a(this,"_haveSyn",void 0),a(this,"_name",void 0),a(this,"_target",void 0),a(this,"_targetWindow",void 0),a(this,"_targetOrigin",void 0),a(this,"_onMessage",void 0),a(this,"_synIntervalId",void 0),!e||!t)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=e,this._target=t,this._targetWindow=n,this._targetOrigin=r,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(X,null,R),this._haveSyn=!1,this._init=!1}_handShake(){this._write(Z,null,R),this.cork()}_onData(e){if(!this._init)e===Z?(this._haveSyn=!0,this._write(j,null,R)):e===j&&(this._init=!0,this._haveSyn||this._write(j,null,R),this.uncork());else if(e===X)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,n){this._postMessage(e),n()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}class Te extends K.Duplex{constructor({parent:e,name:t}){super({objectMode:!0}),a(this,"_parent",void 0),a(this,"_name",void 0),this._parent=e,this._name=t}_read(){}_write(e,t,n){this._parent.push({name:this._name,data:e}),n()}}var Y={exports:{}},Ae=ce;function ce(i,e){if(i&&e)return ce(i)(e);if(typeof i!="function")throw new TypeError("need wrapper function");return Object.keys(i).forEach(function(n){t[n]=i[n]}),t;function t(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];var s=i.apply(this,n),o=n[n.length-1];return typeof s=="function"&&s!==o&&Object.keys(o).forEach(function(c){s[c]=o[c]}),s}}var le=Ae;Y.exports=le(W);Y.exports.strict=le(de);W.proto=W(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return W(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return de(this)},configurable:!0})});function W(i){var e=function(){return e.called?e.value:(e.called=!0,e.value=i.apply(this,arguments))};return e.called=!1,e}function de(i){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=i.apply(this,arguments)},t=i.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}var Q=Y.exports;const be=M(Q);var Oe=Q,Ce=function(){},Pe=globalThis.Bare?queueMicrotask:process.nextTick.bind(process),Ne=function(i){return i.setHeader&&typeof i.abort=="function"},Re=function(i){return i.stdio&&Array.isArray(i.stdio)&&i.stdio.length===3},he=function(i,e,t){if(typeof e=="function")return he(i,null,e);e||(e={}),t=Oe(t||Ce);var n=i._writableState,r=i._readableState,s=e.readable||e.readable!==!1&&i.readable,o=e.writable||e.writable!==!1&&i.writable,c=!1,h=function(){i.writable||d()},d=function(){o=!1,s||t.call(i)},p=function(){s=!1,o||t.call(i)},g=function(y){t.call(i,y?new Error("exited with error code: "+y):null)},f=function(y){t.call(i,y)},m=function(){Pe(w)},w=function(){if(!c){if(s&&!(r&&r.ended&&!r.destroyed))return t.call(i,new Error("premature close"));if(o&&!(n&&n.ended&&!n.destroyed))return t.call(i,new Error("premature close"))}},E=function(){i.req.on("finish",d)};return Ne(i)?(i.on("complete",d),i.on("abort",m),i.req?E():i.on("request",E)):o&&!n&&(i.on("end",h),i.on("close",h)),Re(i)&&i.on("exit",g),i.on("end",p),i.on("finish",d),e.error!==!1&&i.on("error",f),i.on("close",m),function(){c=!0,i.removeListener("complete",d),i.removeListener("abort",m),i.removeListener("request",E),i.req&&i.req.removeListener("finish",d),i.removeListener("end",h),i.removeListener("close",h),i.removeListener("finish",d),i.removeListener("exit",g),i.removeListener("end",p),i.removeListener("error",f),i.removeListener("close",m)}},ue=he;const te=M(ue);var Le=Q,We=ue,D;try{D=ve}catch{}var P=function(){},De=typeof process>"u"?!1:/^v?\.0/.test(process.version),x=function(i){return typeof i=="function"},Ue=function(i){return!De||!D?!1:(i instanceof(D.ReadStream||P)||i instanceof(D.WriteStream||P))&&x(i.close)},Me=function(i){return i.setHeader&&x(i.abort)},xe=function(i,e,t,n){n=Le(n);var r=!1;i.on("close",function(){r=!0}),We(i,{readable:e,writable:t},function(o){if(o)return n(o);r=!0,n()});var s=!1;return function(o){if(!r&&!s){if(s=!0,Ue(i))return i.close(P);if(Me(i))return i.abort();if(x(i.destroy))return i.destroy();n(o||new Error("stream was destroyed"))}}},ie=function(i){i()},Fe=function(i,e){return i.pipe(e)},qe=function(){var i=Array.prototype.slice.call(arguments),e=x(i[i.length-1]||P)&&i.pop()||P;if(Array.isArray(i[0])&&(i=i[0]),i.length<2)throw new Error("pump requires two streams per minimum");var t,n=i.map(function(r,s){var o=s<i.length-1,c=s>0;return xe(r,o,c,function(h){t||(t=h),h&&n.forEach(ie),!o&&(n.forEach(ie),e(t))})});return i.reduce(Fe)},He=qe;const ne=M(He),re=Symbol("IGNORE_SUBSTREAM");class Ge extends K.Duplex{constructor(e={}){super(u(u({},e),{},{objectMode:!0})),a(this,"_substreams",void 0),a(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new Te({parent:this,name:e});return this._substreams[e]=t,je(this,n=>t.destroy(n||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=re}_read(){}_write(e,t,n){const{name:r,data:s}=e;if(!r)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const o=this._substreams[r];return o?(o!==re&&o.push(s),n()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${r}"`),n())}}function je(i,e){const t=be(e);te(i,{readable:!1},t),te(i,{writable:!1},t)}const $e={height:660,width:375},ke={height:700,width:1200},Ve={height:700,width:450},Be="setup_complete",A={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out",TOGGLE_WIDGET_BUTTON:"toggle_widget_button",ALLOW_WALLET_SERVICE:"allow_wallet_service"},v={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_CHECKOUT:"show_checkout",SHOW_WALLET_UI:"show_wallet_ui",SHOW_SWAP:"show_swap",LOGIN_WITH_SESSION_ID:"login_with_session_id"},fe={GET_PROVIDER_STATE:"wallet_get_provider_state",WALLET_SWITCH_CHAIN:"wallet_switchChain"},$={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"};function ze(i){return function(t,n,r){r(s=>{n.error&&k.warn(`Error in RPC response:
`,n),!t.isTorusInternal&&(k.info(`RPC (${i.origin}):`,t,"->",n),s())})}}function me(i){return i!==null&&typeof i=="object"&&typeof i.pipe=="function"}function Ke(i){return me(i)&&i.writable!==!1&&typeof i._write=="function"&&typeof i._writableState=="object"}function Ye(i){return me(i)&&i.readable!==!1&&typeof i._read=="function"&&typeof i._readableState=="object"}function Qe(i){return Ke(i)&&Ye(i)}var _={errors:{disconnected:()=>"Web3Auth: Lost connection to Web3Auth.",permanentlyDisconnected:()=>"Web3Auth: Disconnected from iframe. Page reload required.",unsupportedSync:i=>`Web3Auth: The Web3Auth Ethereum provider does not support synchronous methods like ${i} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:i=>`Invalid options. Received: { maxEventListeners: ${i}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:i=>`'args.logger' must include required method '${i}'.`},info:{connected:i=>`Web3Auth: Connected to chain with ID "${i}".`}},l=k.getLogger("ws-embed");function Je(){return(i,e,t)=>{(typeof i.method!="string"||!i.method)&&(e.error=L.invalidRequest({message:"The request 'method' must be a non-empty string.",data:u(u({},i||{}),{},{cause:"The request 'method' must be a non-empty string."})})),t(n=>{const{error:r}=e;return r&&l.error(`Ws-Embed - RPC Error: ${r.message}`,r),n()})}}function Ze(i,e,t){let n=`Web3Auth: Lost connection to "${i}".`;e!=null&&e.stack&&(n+=`
${e.stack}`),l.warn(n),t&&t.listenerCount("error")>0&&t.emit("error",n)}const Xe=["eth_subscription"];class pe extends ae{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){if(super(),a(this,"rpcEngine",void 0),a(this,"jsonRpcConnectionEvents",void 0),a(this,"isWeb3Auth",void 0),a(this,"state",void 0),!Qe(e))throw new Error(_.errors.invalidDuplexStream());this.isWeb3Auth=!0,this.setMaxListeners(t),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleStreamDisconnect=this.handleStreamDisconnect.bind(this),this.rpcRequest=this.rpcRequest.bind(this),this.initializeState=this.initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this),this.send=this.send.bind(this);const r=new Ge;ne(e,r,e,this.handleStreamDisconnect.bind(this,"Web3Auth")),r.ignoreStream("phishing");const s=Ee();ne(s.stream,r.createStream(n),s.stream,this.handleStreamDisconnect.bind(this,"Web3Auth RpcProvider"));const o=new Se;o.push(ye()),o.push(Je()),o.push(ze({origin:location.origin})),o.push(s.middleware),this.rpcEngine=o,this.jsonRpcConnectionEvents=s.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw L.invalidRequest({message:_.errors.invalidRequestArgs(),data:u(u({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});const{method:t,params:n}=e;if(typeof t!="string"||t.length===0)throw L.invalidRequest({message:_.errors.invalidRequestMethod(),data:u(u({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw L.invalidRequest({message:_.errors.invalidRequestParams(),data:u(u({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});return new Promise((r,s)=>{this.rpcRequest({method:t,params:n},V(r,s))})}send(e,t){this.rpcRequest(e,t)}sendAsync(e){return new Promise((t,n)=>{this.rpcRequest(e,V(t,n))})}handleStreamDisconnect(e,t){Ze(e,t,this),this.handleDisconnect(!1,t?t.message:void 0)}}const O={PRODUCTION:"production",STAGING:"staging",DEVELOPMENT:"development",TESTING:"testing"},C={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"};class et extends ae{constructor({url:e,target:t,features:n,timeout:r=3e4}){super(),a(this,"url",void 0),a(this,"target",void 0),a(this,"features",void 0),a(this,"window",void 0),a(this,"windowTimer",void 0),a(this,"iClosedWindow",void 0),a(this,"timeout",void 0),this.url=e,this.target=t||"_blank",this.features=n||B(ke),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=r,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!==null&&e!==void 0&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}class F extends pe{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"},r){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),a(this,"tryWindowHandle",void 0),a(this,"windowRefs",void 0),a(this,"iframeUrl",void 0),a(this,"iframeId",void 0),this.state=u(u({},F.defaultState),r),this.iframeUrl="",this.iframeId="",this.windowRefs=new Map,this.on("connect",()=>{this.state.isConnected=!0});const s=o=>{const{method:c,params:h}=o;if(c===A.IFRAME_STATUS){const{isFullScreen:d,rid:p}=h;this.displayIframe({isFull:d,rid:p},!0)}else if(c===A.CLOSE_WINDOW)this.handleCloseWindow(h);else if(c===A.USER_LOGGED_IN){const{currentAuthConnection:d}=h;this.state.isLoggedIn=!0,this.state.currentAuthConnection=d}else if(c===A.USER_LOGGED_OUT)this.state.isLoggedIn=!1,this.state.currentAuthConnection=null,this.displayIframe({isFull:!1},!0);else if(c===A.TOGGLE_WIDGET_BUTTON){const{show:d}=h;this.state.widgetVisibility=d,this.displayIframe()}else if(c===A.ALLOW_WALLET_SERVICE){const{allow:d}=h;this.state.allowWalletService=d}};this.jsonRpcConnectionEvents.on("notification",s)}get isLoggedIn(){return this.state.isLoggedIn}get isIFrameFullScreen(){return this.state.isIFrameFullScreen}get allowWalletService(){return this.state.allowWalletService}isConnected(){return this.state.isConnected}async initializeState(e){try{const{torusUrl:t,torusIframeId:n}=e;this.iframeUrl=t,this.iframeId=n;const{currentAuthConnection:r,isLoggedIn:s}=await this.request({method:v.GET_PROVIDER_STATE,params:[]});s&&this.handleConnect(r,s)}catch(t){l.error("Web3Auth: Failed to get initial state. Please report this bug.",t)}finally{l.info("initialized communication state"),this.state.initialized=!0}}displayIframe({isFull:e=!1,rid:t=""}={},n=!1){const r={};if(e)r.display="block",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px";else switch(r.display=this.state.widgetVisibility?"block":"none",r.height=this.state.widgetVisibility?"70px":"0px",r.width=this.state.widgetVisibility?"70px":"0px",this.state.buttonPosition){case C.TOP_LEFT:r.top="0px",r.left="0px",r.right="auto",r.bottom="auto";break;case C.TOP_RIGHT:r.top="0px",r.right="0px",r.left="auto",r.bottom="auto";break;case C.BOTTOM_RIGHT:r.bottom="0px",r.right="0px",r.top="auto",r.left="auto";break;case C.BOTTOM_LEFT:default:r.bottom="0px",r.left="0px",r.top="auto",r.right="auto";break}const s=document.getElementById(this.iframeId);Object.assign(s.style,r),this.state.isIFrameFullScreen=e,n||this.request({method:v.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:t}})}async handleWindow(e,{url:t,target:n,features:r,timeout:s}={}){const o=new URL(t||`${this.iframeUrl}/redirect?windowId=${e}&sessionNamespace=${window.location.hostname}`),c=new et({url:o,target:n,features:r,timeout:s});if(c.open(),!c.window){this.displayIframe({isFull:!0}),this.request({method:v.WINDOW_BLOCKED,params:{windowId:e,finalUrl:o.href}});return}this.windowRefs.set(e,c),c.once("close",()=>{this.windowRefs.delete(e),this.request({method:v.CLOSED_WINDOW,params:{windowId:e}})})}rpcRequest(e,t){const n=t,r=e;Array.isArray(r)||r.jsonrpc||(r.jsonrpc="2.0"),this.rpcEngine.handle(r,n)}handleConnect(e,t){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{currentAuthConnection:e,isLoggedIn:t}),l.debug(_.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new U(1013,t||_.errors.disconnected()),l.debug(n)):(n=new U(1011,t||_.errors.permanentlyDisconnected()),l.error(n),this.state.currentAuthConnection=null,this.state.isLoggedIn=!1,this.state.widgetVisibility=!1,this.state.isIFrameFullScreen=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleCloseWindow(e){const{windowId:t}=e;this.windowRefs.has(t)&&(this.windowRefs.get(t).close(),this.windowRefs.delete(t))}}a(F,"defaultState",{buttonPosition:"bottom-left",currentAuthConnection:null,isIFrameFullScreen:!1,widgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1,hasEmittedConnection:!1,allowWalletService:!1});const tt=i=>{const e=window.document.createElement("template"),t=i.trim();return e.innerHTML=t,e.content.firstChild};var it=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!i(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!==0;){var o=s[r];if(!i(e[o],t[o]))return!1}return!0}return e!==e&&t!==t};const nt=M(it);class q extends pe{constructor(e,{maxEventListeners:t=100,jsonRpcStreamName:n="provider"}){super(e,{maxEventListeners:t,jsonRpcStreamName:n}),a(this,"chainId",void 0),a(this,"selectedAddress",void 0),a(this,"tryWindowHandle",void 0),this.state=u({},q.defaultState),this.selectedAddress=null,this.chainId=null,this.handleAccountsChanged=this.handleAccountsChanged.bind(this),this.handleChainChanged=this.handleChainChanged.bind(this),this.handleUnlockStateChanged=this.handleUnlockStateChanged.bind(this),this.on("connect",()=>{this.state.isConnected=!0});const r=s=>{const{method:o,params:c}=s;o===$.ACCOUNTS_CHANGED?this.handleAccountsChanged(c):o===$.UNLOCK_STATE_CHANGED?this.handleUnlockStateChanged(c):o===$.CHAIN_CHANGED?this.handleChainChanged(c):Xe.includes(o)&&(this.emit("data",s),this.emit("notification",c.result),this.emit("message",{type:o,data:c}))};this.jsonRpcConnectionEvents.on("notification",r)}isConnected(){return this.state.isConnected}async initializeState(){try{const{accounts:e,chainId:t,isUnlocked:n}=await this.request({method:fe.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:t}),this.handleChainChanged({chainId:t}),this.handleUnlockStateChanged({accounts:e,isUnlocked:n}),this.handleAccountsChanged(e)}catch(e){l.error("WsEmbed: Failed to get initial state. Please report this bug.",e)}finally{l.info("initialized provider state"),this.state.initialized=!0}}rpcRequest(e,t,n=!1){let r=t;const s=e;if(!Array.isArray(s)){if(s.jsonrpc||(s.jsonrpc="2.0"),[S.GET_ACCOUNTS,S.ETH_REQUEST_ACCOUNTS,I.SOLANA_REQUEST_ACCOUNTS,I.GET_ACCOUNTS].includes(s.method))r=(o,c)=>{this.handleAccountsChanged(c.result||[],s.method==="eth_accounts",n),t(o,c)};else if(s.method==="wallet_getProviderState"){this.rpcEngine.handle(e,r);return}}this.tryWindowHandle(s,r)}handleConnect(e){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{chainId:e}),l.debug(_.info.connected(e)))}handleDisconnect(e,t){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new U(1013,t||_.errors.disconnected()),l.debug(n)):(n=new U(1011,t||_.errors.permanentlyDisconnected()),l.error(n),this.chainId=null,this.state.accounts=null,this.selectedAddress=null,this.state.isUnlocked=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleAccountsChanged(e,t=!1,n=!1){let r=e;Array.isArray(r)||(l.error("WsEmbed: Received non-array accounts parameter. Please report this bug.",r),r=[]);for(const s of e)if(typeof s!="string"){l.error("WsEmbed: Received non-string account. Please report this bug.",e),r=[];break}nt(this.state.accounts,r)||(t&&Array.isArray(this.state.accounts)&&this.state.accounts.length>0&&!n&&l.error('WsEmbed: "eth_accounts" unexpectedly updated accounts. Please report this bug.',r),this.state.accounts=r,this.emit("accountsChanged",r)),this.selectedAddress!==r[0]&&(this.selectedAddress=r[0]||null)}handleChainChanged({chainId:e}={}){if(!e){l.error("WsEmbed: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this.handleDisconnect(!0):(this.handleConnect(e),e!==this.chainId&&(this.chainId=e,this.state.initialized&&this.emit("chainChanged",this.chainId)))}handleUnlockStateChanged({accounts:e,isUnlocked:t}={}){if(typeof t!="boolean"){l.error("WsEmbed: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this.state.isUnlocked&&(this.state.isUnlocked=t,this.handleAccountsChanged(e||[]))}}a(q,"defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function se(i){return new Promise((e,t)=>{try{const n=document.createElement("img");n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=i}catch(n){t(n)}})}const rt=i=>{const{document:e}=i,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const n=e.querySelector('head > meta[name="title"]');return n?n.content:e.title&&e.title.length>0?e.title:i.location.hostname};async function st(i){try{const{document:e}=i;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await se(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(n=>!!n.href),t&&await se(t.href))?t.href:""}catch{return""}}const ot=async()=>({name:rt(window),icon:await st(window)}),at="5.0.23",oe=`v${at.split(".")[0]}`,z={[O.TESTING]:{url:"https://develop-wallet.web3auth.io",logLevel:"debug"},[O.DEVELOPMENT]:{url:"http://localhost:4050",logLevel:"debug"},[O.STAGING]:{url:`https://staging-wallet.web3auth.io/${oe}`,logLevel:"debug"},[O.PRODUCTION]:{url:`https://wallet.web3auth.io/${oe}`,logLevel:"error"}};(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{url:t}=z.production;e.href=`${t}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){l.warn(e)}})();const ct=new Set([I.SEND_TRANSACTION,I.SIGN_MESSAGE,I.SIGN_TRANSACTION,I.SIGN_ALL_TRANSACTIONS,S.ETH_SIGN,S.ETH_SIGN_TYPED_DATA_V4,S.PERSONAL_SIGN,S.ETH_TRANSACTION,S.ADD_CHAIN,S.SWITCH_CHAIN,fe.WALLET_SWITCH_CHAIN]);class dt{constructor({modalZIndex:e=99999,web3AuthClientId:t,web3AuthNetwork:n}){a(this,"isInitialized",void 0),a(this,"modalZIndex",void 0),a(this,"provider",void 0),a(this,"communicationProvider",void 0),a(this,"buttonPosition",void 0),a(this,"web3AuthClientId",void 0),a(this,"web3AuthNetwork",void 0),a(this,"isPluginMode",void 0),a(this,"confirmationStrategy",void 0),a(this,"buildEnv",void 0),a(this,"embedNonce",H()),this.isInitialized=!1,this.modalZIndex=e,this.web3AuthClientId=t,this.web3AuthNetwork=n}get isLoggedIn(){var e;return((e=this.communicationProvider)===null||e===void 0?void 0:e.isLoggedIn)||!1}get getBuildEnv(){return this.buildEnv}async init({buildEnv:e=O.PRODUCTION,enableLogging:t=!1,chains:n,chainId:r,walletUrls:s,whiteLabel:o,confirmationStrategy:c=T.DEFAULT,accountAbstractionConfig:h,enableKeyExport:d=!1}){if(this.isInitialized)throw new Error("Already initialized");this.buildEnv=e,this.confirmationStrategy=c;const{url:p,logLevel:g}=s&&s[e]?u(u({},z[e]),s[e]):z[e];l.info(p,"url loaded"),l.setDefaultLevel(g),t?l.enableAll():l.disableAll();const f=new URL(p);f.pathname.endsWith("/")?f.pathname+="frame":f.pathname+="/frame";const m=new URLSearchParams;m.append("origin",window.location.origin),m.append("nonce",this.embedNonce),f.hash=m.toString();const w=this.getTheme((o==null?void 0:o.mode)||G.light),E=tt(`<iframe
        id="walletIframe-${this.embedNonce}"
        class="walletIframe-${this.embedNonce}"
        sandbox="allow-popups allow-scripts allow-same-origin allow-forms allow-modals allow-downloads"
        src="${f.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()};
        color-scheme: ${w}"
        allow="clipboard-write"
      ></iframe>`);this.buttonPosition=(o==null?void 0:o.buttonPosition)||C.BOTTOM_LEFT;const y=await ot();return new Promise((b,we)=>{try{window.document.body.appendChild(E);const N=async J=>{if(J.origin!==f.origin)return;const{message:ge,nonce:_e}=J.data||{};ge===Be&&_e===this.embedNonce&&(window.removeEventListener("message",N),E.contentWindow.postMessage({chains:n,chainId:r,dappMetadata:y,enableLogging:t,web3AuthClientId:this.web3AuthClientId,web3AuthNetwork:this.web3AuthNetwork,whiteLabel:o,confirmationStrategy:c,accountAbstractionConfig:h,enableKeyExport:d},f.origin),await this.setupWeb3({torusUrl:p,walletIframe:E}),this.isInitialized=!0,b())};window.addEventListener("message",N)}catch(N){we(N)}})}async login(e={}){if(!this.isInitialized)throw new Error("Call init() first");const t=this.communicationProvider.isIFrameFullScreen;try{!e.authConnection&&!t&&this.communicationProvider.displayIframe({isFull:!0});const n=await new Promise((r,s)=>{const c=Object.values(Ie).includes(this.provider.chainId)?I.SOLANA_REQUEST_ACCOUNTS:S.ETH_REQUEST_ACCOUNTS;this.provider.rpcRequest({method:c,params:[e.authConnection,e.login_hint]},V(r,s))});if(l.info("check: res",n),Array.isArray(n)&&n.length>0)return this.confirmationStrategy===T.AUTO_APPROVE&&l.warn("Confirmation strategy auto approve is not allowed on Embed Mode, using Default instead."),n;throw new Error("Login failed")}catch(n){throw l.error("login failed",n),n}finally{t||this.communicationProvider.displayIframe({isFull:!1})}}async loginWithSessionId(e){if(!this.isInitialized)throw new Error("Call init() first");if(!e.sessionId)throw new Error("sessionId is required");try{const t=await this.communicationProvider.request({method:v.LOGIN_WITH_SESSION_ID,params:[e.sessionId,e.sessionNamespace||""]});if(l.info("check: res",t),t.success)return this.isPluginMode=!0,this.confirmationStrategy===T.POPUP&&l.warn("Confirmation strategy popup is not allowed on Plugin Mode, using Default instead."),t.success;throw new Error("Login failed")}catch(t){throw l.error("login with session id failed",t),t}}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:v.LOGOUT,params:[]})}async cleanUp(){var e;(e=this.communicationProvider)!==null&&e!==void 0&&e.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(n){return n instanceof Element||n instanceof Document}const t=window.document.getElementById(`walletIframe-${this.embedNonce}`);e(t)&&t.remove(),this.isInitialized=!1}async getUserInfo(){return await this.communicationProvider.request({method:v.USER_INFO,params:[]})}async showWalletConnectScanner(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:v.SHOW_WALLET_CONNECT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showWalletUi(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:v.SHOW_WALLET_UI,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showCheckout(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:v.SHOW_CHECKOUT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showSwap(e){const t=e?e.show:!0;this.communicationProvider.displayIframe({isFull:t});try{await this.communicationProvider.request({method:v.SHOW_SWAP,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}getConfirmationStrategyFinal(e){let t=this.confirmationStrategy;return!Array.isArray(e)&&ct.has(e.method)&&this.confirmationStrategy!==T.MODAL&&!this.isPluginMode&&(t=T.POPUP),t}getTheme(e){return e===G.light?"light":e===G.dark||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async setupWeb3(e){l.info("setupWeb3 running");const t=new ee({name:"embed_torus",target:"iframe_torus",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),n=new ee({name:"embed_communication",target:"iframe_communication",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),r=new q(t,{}),s=new F(n,{},{buttonPosition:this.buttonPosition});r.tryWindowHandle=(d,p)=>{const g=d,f=this.getConfirmationStrategyFinal(d),{allowWalletService:m}=s;if(f===T.POPUP&&m){const w=H();s.handleWindow(w,{target:"_blank",features:B(Ve),timeout:500}),g.windowId=w}r.rpcEngine.handle(g,p)},s.tryWindowHandle=(d,p)=>{const g=d,f=this.getConfirmationStrategyFinal(d),{allowWalletService:m}=s;if(f===T.POPUP&&m){const w=H();s.handleWindow(w,{target:"_blank",features:B($e),timeout:500}),g.params.windowId=w}s.rpcEngine.handle(g,p)};const o=d=>{const p=r[d],g=this;r[d]=function(m,w){const{method:E,params:y=[]}=m;if(E===S.ETH_REQUEST_ACCOUNTS||E===I.SOLANA_REQUEST_ACCOUNTS){if(!w)return g.login({authConnection:y[0]});g.login({authConnection:y[0]}).then(b=>w(null,b)).catch(b=>w(b))}return p.apply(this,[m,w])}};o("request"),o("sendAsync"),o("send");const c=new Proxy(r,{deleteProperty:()=>!0}),h=new Proxy(s,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=h,l.info("test setupWeb3 "),await Promise.all([r.initializeState(),s.initializeState(u(u({},e),{},{torusIframeId:e.walletIframe.id}))]),l.debug("WsEmbed - injected provider")}}export{C as BUTTON_POSITION,T as CONFIRMATION_STRATEGY,S as EVM_METHOD_TYPES,Ie as SOLANA_CHAIN_IDS,I as SOLANA_METHOD_TYPES,q as TorusInPageProvider,O as WS_EMBED_BUILD_ENV,dt as default};
